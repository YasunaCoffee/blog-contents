---
title: "Youri7BをローカルLLMで動かして美少女戦士とお話してみた"
emoji: "🌙"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [生成ai, ai, llm]
published: false
---

# はじめに
AITuberを作っている人をXで見かけて、私も作ってみたくなりました！
https://x.com/yasun_ai/status/1721137388184121640?s=20

新しく公開されたRinna社のオープンソースのLLM「youri-7b-chat」を
ChatGPT互換APIでホストできるという点にとても惹かれました。
https://x.com/yasun_ai/status/1721136891045748965?s=20
このツイートは参考記事元のinadaさんとrinna developerアカウントにいいねされて最高に嬉しいです。

こんな感じでAItuberの美少女戦士なりりんを誕生させました！
https://www.youtube.com/watch?v=oC3HKv4HmyA&t=1s

では、AITuberを作成するまでにやったことを書いていきます。

# この記事で分かること
- ローカルPCにLLMをダウンロードしてAPIサーバとして動かす
- ブラウザで簡単に3Dキャラクターと会話できるアプリケーションとつなげる
- オリジナル3Dキャラクターを作る
- システムプロンプトでキャラクター設定をする

# 開発環境
:::message
WSL2
Ubuntu
Python 3.10.12
:::

## PCスペック
:::message
- CPU:	AMD Ryzen 7-5700X 3.4GHz-4.6GHz(8コア16スレッド)
- メモリー:	32GB(DDR4-PC3200 16GB×2)
- SSD/HDD:	SSD 1TB PCIe Gen4 x4 M.2 NVMe
- HDD 2TB Western Digital WD Red 3.5インチ
- GPU:	ZOTAC NVIDIA GeForce RTX4080 (GDDR6X-16GB)
- OS:	Windows 11 Pro 64bit
:::

# ローカルPCにLLMをダウンロードしてAPIサーバとして動かそう
今回はFastChatというオープンソースを使ってOpenAI互換APIのAPIサーバーを作成していきます。
>FastChatは、大規模な言語モデルベースのチャットボットを訓練、提供、評価するためのオープンプラットフォームです。
FastChat は、サポートされているモデルに対して OpenAI 互換 API を提供しているため、FastChat を OpenAI API のローカルのドロップイン代替品として使用できます。FastChatサーバーはopenai-pythonライブラリとcURLコマンドの両方に対応しています。[docs/openai_api.md](https://github.com/lm-sys/FastChat/blob/main/docs/openai_api.md)を参照してください。
(githubより翻訳引用)

https://github.com/lm-sys/FastChat

githubからダウンロードして行きましょう！

```
git clone https://github.com/lm-sys/FastChat.git
cd FastChat
```
以下、このアプリケーションの書き換えはinadaさんの以下の記事をまるっと参考にさせていただきましたので
この記事では割愛させていただきますね。
https://qiita.com/takaaki_inada/items/fcb63da369b5bfd8a3cf?utm_campaign=post_article&utm_medium=twitter&utm_source=twitter_share

コードの書き換えができたら、FastChatのcontroller/worker/serverをシェルのそれぞれのタブで起動します。
```
python3 -m fastchat.serve.controller
python3 -m fastchat.serve.model_worker --model-path rinna/youri-7b-chat --load-8bit
python3 -m fastchat.serve.openai_api_server --host localhost --port 8000
```
これでapiサーバーは完成です！

# ブラウザで簡単に3Dキャラクターと会話できるアプリケーションとつなげよう
AITuberのアバターの部分はどうするの？と思ったらPixivからオープンソースですぐに使えるデモアプリが存在していました。神様ですね。

>ピクシブ社は、「未来にあって当たり前のものを作り続ける」ことを目指して、日々プロダクトを開発しております。(以下のWEBより引用)
ここの文章にめっちゃ共感しました。ピクシブ最高ですね。

>「ChatVRM」は、テキスト・口頭で話しかけた言葉にキャラクターがフルボイスで回答してくれる「キャラクターと会話できる」デモです。WEBブラウザ上で動作でき、3Dキャラクターのインポート・切り替え、キャラクターに併せて声を調整することもできます。(以下のWEBより引用)

https://inside.pixiv.blog/2023/04/28/160000

>VRMファイルをインポートしてキャラクターに合わせた声の調整や、感情表現を含んだ返答文の生成などを行うことができます。（githubより引用）
https://github.com/pixiv/ChatVRM

早速ChatVRMをgithubからダウンロードしていきましょう。
```
git clone git@github.com:pixiv/ChatVRM.git
npm install
npm run dev
```
こちらから動作を確認します。
```
http://localhost:3000
```
Vtuberの声の部分もrinna社が提供しているAPIで設定していきます。
無料枠もあるので試しやすいです。以下からAPIキーを取得していきましょう。
https://koemotion.rinna.co.jp/


# オリジナル3Dキャラクターを作ろう

# システムプロンプトでキャラクター設定をしよう
